{% extends 'admin-dashboard/base.html' %}
{% load static %}
{% block title %}新增行程{% endblock %}

{% block content %}
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>新增行程</h5>
                </div>
                <div class="ibox-content">
                    <form id="registerForm" method="POST">  
                        
                        <div class="mb-3">
                            <label for="InputName" class="form-label">景點名稱</label>
                            <input type="text" class="form-control" id="InputName" name="name">
                            <div id="nameHelp" class="form-text"></div>
                        </div>
                        <div class="mb-3">
                            <label for="InputTxt" class="form-label">景點介紹</label>
                            <textarea style="height: 100Px;" type="text" class="form-control" id="InputTxt" name="txt" >
                            </textarea>
                            <div id="divTxt" class="form-text"></div>
                        </div>
                        <div class="mb-3">
                            <label for="InputTel" class="form-label">電話資訊</label>
                            <input type="tel" class="form-control" id="InputTel" name="tel" >
                            <div id="divTel" class="form-text"></div>
                        </div>
                        <div class="mb-3">
                            <label for="InputAddress" class="form-label">景點地址</label>
                            <input type="text" class="form-control" id="InputAddress" name="address">
                            <div id="divAddress" class="form-text"></div>
                        </div>
                        <div class="mb-3">
                            <label for="InputRegion" class="form-label">縣/市(台請用臺書寫)</label>
                            <input type="region" class="form-control" id="InputRegion" name="region">
                            <div id="divRegion" class="form-text"></div>
                        </div>
                        <div class="mb-3">
                            <label for="InputTown" class="form-label">鄉/鎮/市/區</label>
                            <input type="town" class="form-control" id="InputTown" name="town">
                            <div id="divTown" class="form-text"></div>
                        </div>
                        <div class="mb-3">
                            <label for="formFile1" class="form-label">圖片1(連結)</label>
                            <input class="form-control" type="url" id="formFile1" name="image1">
                        </div>
                        <div class="mb-3">
                            <label for="formFile2" class="form-label">圖片2(連結)</label>
                            <input class="form-contro2" type="url" id="formFile2" name="image2">
                        </div>
                        <div class="mb-3">
                            <label for="formFile3" class="form-label">圖片3(連結)</label>
                            <input class="form-control" type="url" id="formFile3" name="image3">
                        </div>
                        <div class="mb-3">
                            <label for="InputLinginfo" class="form-label">交通</label>
                            <input type="text" class="form-control" id="Linginfo" name="linginfo">
                        </div>
                        <div class="mb-3">
                            <label for="InputOpentime" class="form-label">營業時間</label>
                            <input type="text" class="form-control" id="InputOpentime" name="opentime">
                        </div>
                        <div class="mb-3">
                            <h7>經度/緯度(範例:41.40338, 2.17403 小數點只到第五位)</h7>
                            <label for="InputPx" class="form-label">經度:</label>
                            <input type="number" step='0.00001' class="form-control" id="InputPx" name="Px">
                            <label for="InputPy" class="form-label">緯度:</label>
                            <input type="number" step='0.00001' class="form-control" id="InputPy" name="Py">
                            <div id="divpxy" class="form-text"></div>
                        </div>
                        <div class="mb-3">
                            <label for="InputWbsite" class="form-label">網站資訊</label>
                            <input type="text" class="form-control" id="InputWebsite" name="website">
                        </div>
                        <div class="mb-3">
                            <label for="InputTicketinfo" class="form-label">票價</label>
                            <input type="text" class="form-control" id="InputTicketinfoe" name="ticketinfo">
                        </div>
                        <div class="mb-3">
                            <label for="InputParkinginfo" class="form-label">附近停車場</label>
                            <input type="text" class="form-control" id="InputParkinginfo" name="parkinginfo">
                            <div id="nameHelp" class="form-text"></div>
                        </div>
                        <div>
                            <label for="InputParkinginfo" class="form-label">景點屬性:</label>
                            <label>
                                <input type="checkbox" name="class" value="1" onclick="return checkCount(this)" >1.文化類
                            </label>
                            <label>
                                <input type="checkbox" name="class" value="2" onclick="return checkCount(this)">2.生態類
                            </label>
                            <label>
                                <input type="checkbox" name="class" value="3" onclick="return checkCount(this)">3.古蹟類
                            </label>
                            <label>
                                <input type="checkbox" name="class" value="4" onclick="return checkCount(this)">4.廟宇類
                            </label>
                            <label><input type="checkbox" name="class" value="5" onclick="return checkCount(this)">5.藝術類
                            </label>
                            <label><input type="checkbox" name="class" value="6" onclick="return checkCount(this)">6.小吃/特產類
                            </label>
                            <label><input type="checkbox" name="class" value="7" onclick="return checkCount(this)">7.國家公園類
                            </label>
                            <label>
                                <input type="checkbox" name="class" value="8" onclick="return checkCount(this)">8.國家風景區類
                            </label>
                            <label>
                                <input type="checkbox" name="class" value="9" onclick="return checkCount(this)">9.休閒農業類
                            </label>
                            <label>
                                <input type="checkbox" name="class" value="10" onclick="return checkCount(this)" >10.溫泉類
                            </label>
                            <label>
                                <input type="checkbox" name="class" value="11" onclick="return checkCount(this)">11.自然風景類
                            </label>
                            <label>
                                <input type="checkbox" name="class" value="12" onclick="return checkCount(this)">12.遊憩類
                            </label>
                            <label>
                                <input type="checkbox" name="class" value="13" onclick="return checkCount(this)">13.體育健身類
                            </label>
                            <label>
                                <input type="checkbox" name="class" value="14" onclick="return checkCount(this)">14.觀光工廠類
                            </label>
                            <label>
                                <input type="checkbox" name="class" value="15" onclick="return checkCount(this)">15.都會公園類
                            </label>
                            <label>
                                <input type="checkbox" name="class" value="16" onclick="return checkCount(this)">16.森林遊樂區類
                            </label>
                            <label>
                                <input type="checkbox" name="class" value="17" onclick="return checkCount(this)">17.林場類
                            </label>
                            <label>
                                <input type="checkbox" name="class" value="18" onclick="return checkCount(this)">
                                18.其他
                            </label>
                        </div>
                        <button type="submit" class="btn btn-primary" id="buttonSubmit">送出</button>
                    </form>
                    <div id="div1" class="alert alert-info mt-3"></div>
                    <a href="/travel/" class="btn btn-danger">回首頁</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    var checkedCount = 0;
    function checkCount(obj) {
        if (obj.checked === true) {
            if (checkedCount >= 3) {
                alert("最多只能選3項喔");
                return false;
            }
            checkedCount++;
        }
        else {
            checkedCount--;
        }
        return true
    }
    
    const inpName = document.querySelector('#InputName')
    const divName = document.querySelector('#nameHelp')
    inpName.addEventListener("blur", async ()=>{  
        const response = await fetch(`/travel/travelName/?name=${inpName.value}`)
        const nameInfo = await response.json()
        if (nameInfo.name_exists){
            divName.innerText= '景點名稱已存在'
        }
        else {
            divName.innerText =''
        }
        divName.innerHTML= divName.innerText
    })

    const inpTxt = document.querySelector('#InputTxt')

    const inpTel = document.querySelector('#InputTel')
    const divTel = document.querySelector('#divTel')
    inpTel.addEventListener("blur", async ()=>{
        const response = await fetch(`/travel/travelTel/?tel=${inpTel.value}`)
        const telInfo = await response.json()

        if (telInfo.tel_exists){
            divTel.innerText= '電話已註冊'
        }
        else {
            divTel.innerText =''
        }

        divTel.innerHTML= divTel.innerText
    })
    

    const inpAddress = document.querySelector('#InputAddress')
    const divAddress = document.querySelector('#divAddress')
    inpAddress.addEventListener("blur", async()=>{
      const response = await fetch(`/travel/travelAddress/?address=${inpAddress.value}`)
      const addressInfo = await response.json()
      if (addressInfo.address_exists){
        divAddress.innerText= '地址已註冊';
      }
      else {
        divAddress.innerText ='';
      }

      divAddress.innerHTML= divAddress.innerText
    })

    const inputRegion = document.querySelector('#InputRegion')
    const divRegion = document.querySelector('#divRegion')
    inputRegion.addEventListener("blur", async()=>{
      const response = await fetch(`/travel/travelRegion/?region=${inputRegion.value}`)
      const regionInfo = await response.json()
      if (regionInfo.region_exists){
        divRegion.innerText= '縣市填寫錯誤';
      }
      else {
        divRegion.innerText ='';
      }
      divRegion.innerHTML= divRegion.innerText
    })

    const inputTown = document.querySelector('#InputTown')
    const divTown = document.querySelector('#divTown')
    inputTown.addEventListener("blur", async()=>{
      const response = await fetch(`/travel/travelTown/?town=${inputTown.value}&region=${inputRegion.value}`)
      const townInfo = await response.json()
      if (townInfo.town_exists){
        divTown.innerText= '鄉鎮市區不存在';
      }
      else {
        divTown.innerText ='';
      }

      divTown.innerHTML= divTown.innerText
    })



  const divInfo = document.querySelector('#div1')
  const btnSubmit = document.querySelector('#buttonSubmit')
   btnSubmit.addEventListener('click', async (event) => {
      event.preventDefault()
      
      const myForm = document.querySelector('#registerForm')
      const formData = new FormData(myForm)
      const divInfo = document.querySelector('#div1')
      
      try {
          const response = await fetch('/travel/register01/', {
              method: 'POST',
              body: formData,
              headers: {
                  'X-CSRFToken': '{{ csrf_token }}'
              }
          })
          const data = await response.json()
          
          // 根據狀態設置不同的樣式
          if (data.status === 'error') {
              divInfo.className = 'alert alert-danger mt-3'
          } else {
              divInfo.className = 'alert alert-success mt-3'
          }
          divInfo.innerHTML = data.message
          
      } catch (error) {
          divInfo.className = 'alert alert-danger mt-3'
          divInfo.innerHTML = '發生錯誤，請稍後再試'
      }
  })

</script>
{% endblock %}
{% block styles %}
<style>
    .mb-3 {
        margin-bottom: 1rem;
    }
    .form-label {
        margin-bottom: 0.5rem;
    }
    .form-control {
        margin-bottom: 0.5rem;
    }
    .checkbox-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 10px;
        margin: 15px 0;
    }
    .checkbox-list label {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
    }
    .form-text {
        color: #dc3545;
        font-size: 0.875em;
    }
    .alert-info:contains("您好，景點") {
        background-color: #d4edda;
        border-color: #c3e6cb;
        color: #155724;
    }
    
    .alert-info:not(:contains("您好，景點")) {
        background-color: #f8d7da;
        border-color: #f5c6cb;
        color: #721c24;
    }
</style>
{% endblock %}